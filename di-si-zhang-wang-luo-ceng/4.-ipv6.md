# 4. IPv6

## 1. 为什么有 IPv6？

32 位 IPv4 地址空间已分配殆尽......

CIDR & NAT 治标不治本

IPv6 从根本上解决地址消耗殆尽的问题

## 2. IPv6 数据报格式

![](../.gitbook/assets/image%20%28166%29.png)

固定 **40B** 基本首部，路由器处**不能分片**（如果报文过长，只能丢弃）

![](../.gitbook/assets/image%20%28177%29.png)

**版本：**指明了协议版本，总是 6

**优先级：**区分数据报的类别和**优先级**

**流：**互联网络上从特定源点到特定终点的一系列数据报。所有属于同一个流的数据报都具有相同的**流标签**

**下一个首部：**标识下一个扩展首部或上层协议首部

**跳数限制：**相当于 IPv4 的 TTL

## 3. IPv6 & IPv4 区别

1. IPv6 将地址从 32 位（4B）扩大到 **128为（16B）**，更大的地址空间
2. IPv6 将 IPv4 的**校验和字段彻底移除**，以减少每跳的处理时间
3. IPv6 将 IPv4 的可选字段移出首部，变成了**扩展首部**，成为灵活的首部格式，路由器通常不对扩展首部进行检查，大大提高了路由器的处理效率
4. IPv6 支持**即插即用**（即自动配置），不需要 DHCP 协议
5. IPv6 首部长度必须是 **8B 的整数倍**，IPv4 首部是 4B 的整数倍
6. IPv6 **只能在主机处分片**，IPv4 可以在路由器和主机处分片
7. ICMPv6：附加报文类型 “分组过大”
8. IPv6 支持资源的预分配，支持实时视像等要求，保证一定的带宽和时延的应用
9. IPv6 取消了协议字段，改成下一个首部字段
10. IPv6 取消了总长度字段，改用有效载荷长度字段
11. IPv6 取消了服务类型字段

## 4. IPv6 地址表示形式

一般形式：**冒号十六进制记法：**4BF5:AA12:0216:FEBC:BA5F:039A:BE9A:2170

**压缩形式：**4BF5:0000:0000:0000:BA5F:039A:000A:2176

                    4BF5:0:0:0:BA5F:39A:A:2176

**零压缩：**一连串连续的 0 可以被一对冒号取代（**双冒号表示法在一个地址中仅可出现一次**）

FF05:0:0:0:0:0:0:B3

FF05::B3

## 5. IPv6 基本地址类型

**单播：**一对一通信，可做源地址 + 目的地址

![](../.gitbook/assets/image%20%28178%29.png)

**多播：**一对多通信，可做目的地址

![](../.gitbook/assets/image%20%28168%29.png)

**任播：**一对多中的一个通信，可做目的地址

![](../.gitbook/assets/image%20%28164%29.png)

## 6. IPv6 向 IPv4 过渡的策略

### 1. 双栈协议

指在一台设备上**同时启用 IPv4 协议栈和 IPv6 协议栈**。这样的话，这台设备既可以和 IPv4 网络通信，又能和 IPv6 网络通信。如果这台设备是一个**路由器**，那么这台路由器的不同接口上，分别配置了 IPv4 地址和 IPv6 地址，并很可能分别连接了 IPv4 网络和 IPv6网络。如果这台设备是一个**计算机**，那么它将同时拥有 IPv4 地址和 IPv6 地址，并具备同时处理这两个协议地址的功能。

### 2. 隧道技术

通过使用互联网络的基础设施在网络之间传递数据的方式。使用隧道传递的数据（或负载）可以是不同协议的数据帧或包。隧道协议将其他协议的数据帧或包**重新封装**然后通过隧道发送。

## 7. 知识脑图

![](../.gitbook/assets/ipv6.svg)

