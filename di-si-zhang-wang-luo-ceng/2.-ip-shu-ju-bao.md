# 2. IP 数据报

## 1. IP 数据报格式

### 1.1 TCP/IP 协议栈

![](../.gitbook/assets/image%20%2893%29.png)

### 1.2 IP 数据报格式

![](../.gitbook/assets/image%20%28115%29.png)

#### 首部细节

![](../.gitbook/assets/image%20%28109%29.png)

**版本：**占 4 位，指 IP 协议的版本。（IPv4/IPv6）

**首部长度：**占 4 位，单位是 4B，最小为 5（因为首部固定部分 20B，5 \* 4B = 20B），最大为 15（15 \* 4B = 60B）

**区分服务：**占 8 位，用来获取更好的服务（如：优先级），但实际上一直没有用过

**总长度：**占 16 位，首部 + 数据部分的总长度，单位是 1B，因此数据报的总长度为 $$2^{16} - 1 = 65535 B$$ 

**生存时间（TTL）：**占 8 位，IP 分组的保质期，经过一个路由器就 -1，变为 0 则丢弃

**协议：**占 8 位，数据部分的协议，即传输层使用的是什么协议

| 协议名 | ICMP | IGMP | TCP | EGP | IGP | UDP | IPv6 | ESP | OSPF |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 字段值 | 1 | 2 | **6** | 8 | 9 | **17** | 41 | 50 | 89 |

**首部检验和：**占 16 位，只检验数据报的首部，但不包含数据部分。每经过一个路由器，都会重新计算一下首部检验和。

**源地址：**占 32 位

**目的地址：**占 32 位

**可选字段：**占 0 ~ 40 位，用来支持排错、测量以及安全措施

**填充：**全 0，把首部长度补成 4B 的整数倍

### 1.3 IP 数据报分片





